#!/bin/sh
# Pre-commit: lint and test must pass. Exits with 1 on first failure so Git aborts the commit.
cd "$(git rev-parse --show-toplevel)"

echo "Running golangci-lint..."
if ! go run github.com/golangci/golangci-lint/v2/cmd/golangci-lint@v2.10.1 run ./...; then
	echo "Lint failed."
	exit 1
fi

echo "Running tests..."
if ! go test ./... -count=1; then
	echo "Tests failed."
	exit 1
fi

echo "Lint and tests passed."
exit 0
